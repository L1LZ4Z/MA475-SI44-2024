<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Expansión y Ecualización del Histograma</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
    }
    #contenedor-imagen {
        margin: 20px auto;
    }
    canvas {
        border: 1px solid black;
    }
    button {
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        margin: 10px;
    }
</style>
</head>
<body>
<h1>Expansión y Ecualización del Histograma</h1>
<div id="contenedor-imagen">
    <canvas id="canvas-original" width="400" height="300"></canvas>
    <canvas id="canvas-procesado" width="400" height="300"></canvas>
</div>
<button onclick="aplicarExpansiónHistograma()">Aplicar Expansión del Histograma</button>
<button onclick="aplicarEcualizaciónHistograma()">Aplicar Ecualización del Histograma</button>

<script>
// Funciones para la expansión y ecualización del histograma

function expansiónHistograma(datosImagen) {
    var píxeles = datosImagen.data;
    var mínimo = 255, máximo = 0;

    // Encontrar valores de intensidad mínima y máxima
    for (var i = 0; i < píxeles.length; i += 4) {
        var intensidad = (píxeles[i] + píxeles[i + 1] + píxeles[i + 2]) / 3;
        if (intensidad < mínimo) mínimo = intensidad;
        if (intensidad > máximo) máximo = intensidad;
    }

    // Realizar expansión del histograma
    var pendiente = 255 / (máximo - mínimo);        //m
    var independiente = 255 - (pendiente * máximo); //b
    for (var i = 0; i < píxeles.length; i += 4) {
        var intensidad = (píxeles[i] + píxeles[i + 1] + píxeles[i + 2]) / 3;
        intensidad = (pendiente * intensidad) + independiente;
        píxeles[i] = píxeles[i + 1] = píxeles[i + 2] = intensidad;
    }

    return datosImagen;
}

function ecualizaciónHistograma(datosImagen) {
    var píxeles = datosImagen.data;
    var histograma = new Array(256).fill(0);
    var histogramaAcumulado = new Array(256).fill(0);

    // Calcular histograma
    for (var i = 0; i < píxeles.length; i += 4) {
        var intensidad = (píxeles[i] + píxeles[i + 1] + píxeles[i + 2]) / 3;
        histograma[Math.floor(intensidad)]++;
    }

    // Calcular histograma acumulado
    histogramaAcumulado[0] = histograma[0];
    for (var i = 1; i < 256; i++) {
        histogramaAcumulado[i] = histogramaAcumulado[i - 1] + histograma[i];
    }

    // Realizar ecualización del histograma
    var escala = 255 / (píxeles.length / 4);
    for (var i = 0; i < píxeles.length; i += 4) {
        var intensidad = (píxeles[i] + píxeles[i + 1] + píxeles[i + 2]) / 3;
        var nuevaIntensidad = Math.round(histogramaAcumulado[Math.floor(intensidad)] * escala);
        píxeles[i] = píxeles[i + 1] = píxeles[i + 2] = nuevaIntensidad;
    }

    return datosImagen;
}

// Aplicar expansión del histograma a la imagen
function aplicarExpansiónHistograma() {
    var canvasOriginal = document.getElementById('canvas-original');
    var canvasProcesado = document.getElementById('canvas-procesado');
    var contextoOriginal = canvasOriginal.getContext('2d');
    var contextoProcesado = canvasProcesado.getContext('2d');
    
    var imagen = new Image();
    imagen.onload = function() {
        contextoOriginal.drawImage(imagen, 0, 0, canvasOriginal.width, canvasOriginal.height);
        var datosImagenOriginal = contextoOriginal.getImageData(0, 0, canvasOriginal.width, canvasOriginal.height);
        var datosImagenExpandida = expansiónHistograma(datosImagenOriginal);
        contextoProcesado.putImageData(datosImagenExpandida, 0, 0);
    };
    imagen.src = 'img/example1.jpg';
}

// Aplicar ecualización del histograma a la imagen
function aplicarEcualizaciónHistograma() {
    
    var canvasOriginal = document.getElementById('canvas-original');
    var canvasProcesado = document.getElementById('canvas-procesado');
    var contextoOriginal = canvasOriginal.getContext('2d');
    var contextoProcesado = canvasProcesado.getContext('2d');
    
    var imagen = new Image();
    imagen.onload = function() {
        contextoOriginal.drawImage(imagen, 0, 0, canvasOriginal.width, canvasOriginal.height);
        var datosImagenOriginal = contextoOriginal.getImageData(0, 0, canvasOriginal.width, canvasOriginal.height);
        var datosImagenEcualizada = ecualizaciónHistograma(datosImagenOriginal);
        contextoProcesado.putImageData(datosImagenEcualizada, 0, 0);
    };
    imagen.src = 'img/example1.jpg';
}
</script>
</body>
</html>
